---
page_title: "mist_upgrade_site_devices Resource - terraform-provider-mist"
subcategory: "Devices"
description: |-
  This resource can be used to upgrade the frimware for device of the same type (Wi-Fi Access Points, Switches and SRX/SSR Gateways) belonging to the same Site.
  The resource will send the upgrade command to Mist, which will take care of deploying the new firmware version to the device, and reboot it if required.
  The time required to upgrade a device depends on the type of device and its hardware. By default, the resource will track the upgrade process and only return the result once the device is upgraded and rebooted (unless reboot==false or reboot_at is set).If required it is possible to run the upgrade in async mode (attribute sync=false). In this case, the resource will only trigger the upgrade and return the Mist response, but will not track the upgrade progress.
  The list of available firmware versions can be retrieved with the mist_device_versions data source.
---

# mist_upgrade_site_devices (Resource)

This resource can be used to upgrade the frimware for device of the same type (Wi-Fi Access Points, Switches and SRX/SSR Gateways) belonging to the same Site.

The resource will send the upgrade command to Mist, which will take care of deploying the new firmware version to the device, and reboot it if required.

The time required to upgrade a device depends on the type of device and its hardware. By default, the resource will track the upgrade process and only return the result once the device is upgraded and rebooted (unless `reboot`==`false` or `reboot_at` is set).  
If required it is possible to run the upgrade in async mode (attribute `sync`=`false`). In this case, the resource will only trigger the upgrade and return the Mist response, but will not track the upgrade progress.

The list of available firmware versions can be retrieved with the `mist_device_versions` data source.


## Example Usage

```terraform
resource "mist_upgrade_device" "upgrade_one" {
  site_id = mist_site.terraform_test.id
  device_id = mist_device_switch.switch_one.id
  upgrade_to_version = "24.2R1-S1.10"
  reboot = true
  sync_upgrade_timeout = 3600
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `site_id` (String)
- `target_version` (String) firmware version to deploy to the device. Use the `mist_device_versions` datasource to get the list of available firmware versions

### Optional

- `canary_phases` (List of Number) Only if `strategy`==`canary`. Phases for canary deployment. Each phase represents percentage of devices that need to be upgraded in that phase. default is [1, 10, 50, 100]
- `device_ids` (List of String) id's of devices which will be selected for upgrade
- `enable_p2p` (Boolean) For APs only. Whether to allow local AP-to-AP FW upgrade
- `force` (Boolean) `force`==`true` will force upgrade when requested version is same as running version
- `max_failure_percentage` (Number) If `strategy`!=`big_bang`. percentage of failures allowed across the entire upgrade
- `max_failures` (List of Number) If `strategy`==`canary`. Number of failures allowed within each phase. Only applicable for `canary`. Array length should be same as `canary_phases`. Will be used if provided, else `max_failure_percentage` will be used
- `models` (List of String) Models which will be selected for upgrade
- `p2p_cluster_size` (Number) For APs only and if `enable_p2p`==`true`.
- `p2p_parallelism` (Number) For APs only and if `enable_p2p`==`true`. Number of parallel p2p download batches to create
- `reboot` (Boolean) For Switches and Gateways only (APs are automatically rebooted). Reboot device immediately after upgrade is completed
- `reboot_at` (Number) For Switches and Gateways only and if `reboot`==`true`. Reboot start time in epoch seconds, default is `start_time`
- `rrm_first_batch_percentage` (Number) For APs only and if `strategy`==`rrm`. Percentage of APs that need to be present in the first RRM batch
- `rrm_max_batch_percentage` (Number) For APs only and if `strategy`==`rrm`. Max percentage of APs that need to be present in each RRM batch
- `rrm_mesh_upgrade` (String) For APs only and if `strategy`==`rrm`. Whether to upgrade mesh AP’s parallelly or sequentially at the end of the upgrade. enum: `parallel`, `sequential`
- `rrm_node_order` (String) For APs only and if `strategy`==`rrm`. Used in rrm to determine whether to start upgrade from fringe or center AP’s. enum: `center_to_fringe`, `fringe_to_center`
- `rrm_slow_ramp` (Boolean) For APs only and if `strategy`==`rrm`. True will make rrm batch sizes slowly ramp up
- `rules` (List of Map of String) Rules used to identify devices which will be selected for upgrade. Device will be selected as long as it satisfies any one rule  
Property key defines the type of matching, value is the string to match. e.g:
  * `match_name`: Device name must match the property value
  * `match_name[0:3]`: Device name must match the first 3 letters of the property value
  * `match_name[2:6]`: Device name must match the property value from the 2nd to the 6th letter
  * `match_model`: Device model must match the property value
  * `match_model[1:3]`: Device model must match the property value from the 1nd to the 3rd letter
- `snapshot` (Boolean) For Junos devices only. Perform recovery snapshot after device is rebooted
- `start_time` (Number) Upgrade start time in epoch seconds, default is now
- `strategy` (String) For APs only. enum: `big_bang` (upgrade all at once), `canary`, `rrm`, `serial` (one at a time)
- `sync_upgrade` (Boolean) if set to `false`, the provider will just trigger the upgrade and not wait for the end of the upgrade process. Default is `true`
- `sync_upgrade_refresh_interval` (Number) if set to `sync_upgrade`==`true`, how long to wait between each refresh of the upgrade status, in seconds. Default is 30, minimum is 15
- `sync_upgrade_start_timeout` (Number) if set to `sync_upgrade`==`true`, how long to wait for the upgrade to start before raising an error, in seconds. Default is 60, minimum is 60
- `sync_upgrade_timeout` (Number) if set to `sync_upgrade`==`true`, how long to wait for the upgrade to end before raising an error, in seconds. Default is 1800

### Read-Only

- `current_phase` (Number) Current canary or rrm phase in progress
- `status` (String) status upgrade is in. enum: `cancelled`, `completed`, `created`, `downloaded`, `downloading`, `failed`, `upgrading`, `queued`
- `targets` (Attributes) (see [below for nested schema](#nestedatt--targets))
- `upgrade_id` (String)
- `upgrade_plan` (Map of List of String) If `stragegy`!=`big_bang`, a dictionary of phase number to devices part of that phase

<a id="nestedatt--targets"></a>
### Nested Schema for `targets`

Read-Only:

- `download_requested` (List of String) List of devices MAC Addresses which cloud has requested to download firmware
- `downloaded` (List of String) List of devices MAC Addresses which have the firmware downloaded
- `downloading` (List of String) List of devices MAC Addresses which are currently downloading the firmware
- `failed` (List of String) List of devices MAC Addresses which have failed to upgrade
- `reboot_in_progress` (List of String) List of devices MAC Addresses which are rebooting
- `rebooted` (List of String) List of devices MAC Addresses which have rebooted successfully
- `scheduled` (List of String) List of devices MAC Addresses which cloud has scheduled an upgrade for
- `skipped` (List of String) List of devices MAC Addresses which skipped upgrade since requested version was same as running version. Use force to always upgrade
- `total` (Number) Count of devices part of this upgrade
- `upgraded` (List of String) Count of devices which have upgraded successfully


